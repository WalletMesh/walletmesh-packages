# Project Guidelines

## Repository Overview

### Standards

- Use pnpm for package management
- Use TypeScript for all code
- Use `changeset` for versioning and changelogs
- Use biome for linting and formatting. Run `pnpm lint:fix` and `pnpm format:fix` to fix issues
- Use vitest for testing

### Structure

- `core/`: Core walletmesh packages
   - `core/jsonrpc/`: Base JSON-RPC 2.0 implementation. Published as `@walletmesh/jsonrpc`
   - `core/router/`: JSON-RPC Wallet Router. Enables managing multi-chain wallet connections. Published as `@walletmesh/router`
   - `core/modal/`: Library for dApps to use to display a wallet connection modal. Published as `@walletmesh/modal`
   - `core/discovery/`: Cross-origin wallet discovery protocol. Published as `@walletmesh/discovery`
- `aztec/`: Aztec-specific packages. Published as `@walletmesh/aztec-*`
   - `aztec/meta`: Meta package containing all WalletMesh Aztec packages. Published as `@walletmesh/aztec`
   - `aztec/rpc-wallet`: JSON-RPC backend & dApp provider for Aztec network. Published as `@walletmesh/aztec-rpc-wallet`
   - `aztec/helpers`: Helper utilities for Aztec integration. Published as `@walletmesh/aztec-helpers`

## Documentation and Memory Management

- Use TSDoc standards for documenting all code
- The `docs/` directory in each package contains only autogenerated documentation
- CLAUDE.md files serve as the primary knowledge base for each package:
  - Root CLAUDE.md contains project-wide information and architecture
  - Package-specific CLAUDE.md files contain detailed implementation information
  - Always reference and update CLAUDE.md files when making significant changes
  - All AI assistants (including cline) should reference these files for package information

# Code Quality Rules

## Testing

- Ensure all code changes have test coverage before completion
- Write tests for both happy paths and error cases
- All tests must pass before submitting changes
- Run `pnpm test` to run all tests or `pnpm test -- src/path/to/file.test.ts` for specific tests

## Linting and Formatting

- Run `pnpm lint:fix` and `pnpm format:fix` before committing changes
- Fix underlying issues rather than disabling lint rules
- Never disable lint rules without explicit user approval
- Document any approved lint rule disabling with a comment explaining the reason

## TypeScript Standards

- Use strict TypeScript with explicit return types
- Avoid using `any` type; prefer `unknown` when type is uncertain
- Use interfaces for object types when possible
- Use proper type narrowing with type guards

## Git Workflow

- Create feature branches from `main`
- Use descriptive commit messages
- Create a changeset for any changes that affect package versions
- Run verification steps before creating a PR: `pnpm lint && pnpm type-check:build && pnpm test`
